#!/bin/env bash

__fallback="${XDG_PICTURES_DIR:-${HOME}/Pictures}"
__paths=()
__recursive=false

if ! [[ -e "${__fallback}" ]]; then
  mkdir -p "${__fallback}"
fi

function usage {
  echo "Usage: fehl [OPTIONS] [FILES | DIRECTORIES]"
  echo ""
  echo "FILES must be any image files or directories. If not supplied, defaults to \$XDG_PICTURES_DIR"
  echo ""
  echo "Options:"
  echo " --help, -h        print this help message and exit"
}

while [[ "$#" -gt 0 ]]; do
  if [[ "$1" = -* ]]; then
    case "$1" in
      --help | -h )
        usage
        exit 0
        ;;
      * )
        echo "error: invalid option $1"
        usage
        exit 1
        ;;
    esac
  else
    [[ -d "$1" ]] && __recursive=true
    __paths+=("$1")
  fi
  shift
done

if [[ ${#__paths[@]} = 0 ]]; then
  feh --recursive "${__fallback}" || notify-send -u critical -t 5000 -a Photos "No loadable images" "${__fallback} directory is empty"
else
  if "${__recursive}"; then
    feh --recursive "${__paths[@]}"
  else
    feh --start-at "${__paths[@]}"
  fi
fi
